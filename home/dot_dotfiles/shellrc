shopt -s checkwinsize

case "$(uname -s)" in
Darwin*)
  export PATH="/Applications/Visual Studio Code.app/Contents/Resources/app/bin":$PATH
  ;;
MSYS_NT*)
  export PATH=$(echo "$PATH" | xargs -d ';' cygpath -u | grep . | paste -sd : -)
  alias npm="cmd //c npm.cmd"
  ;;
*)
  ;;
esac

export PATH=$HOME/.local/bin:$HOME/.dotfiles/scripts:$PATH
export MSYS=winsymlinks:nativestrict
export MSYS2_PATH_TYPE=inherit

if [ ! -f "$HOME/.local/bin/starship.exe" ]; then
  sh -c "$(curl -fsSL https://starship.rs/install.sh)" -- --bin-dir "$HOME/.local/bin" --yes
fi

export EDITOR=nvim

alias c='chezmoi'
alias ce='chezmoi edit'
alias cg='chezmoi git --'
alias e='nvim'
alias g='git'
alias vim='nvim'

function workspace() {
  source "$HOME/.dotfiles/scripts/workspace"
}

alias ws='workspace'

function _workspace() {
  local locals="$(git for-each-ref --format='%(refname:lstrip=2)' refs/heads/)"
  local remotes="$(git for-each-ref --format='%(refname:lstrip=3)' refs/remotes/)"
  local current="$(git branch --show-current)"
  local workspaces="$(echo -e "$locals\n$remotes" | grep -v HEAD | grep -v "$current" | sort -u)"
  COMPREPLY=($(compgen -W "$workspaces" -- "${COMP_WORDS[1]}"))
}

complete -F _workspace workspace
complete -F _workspace ws

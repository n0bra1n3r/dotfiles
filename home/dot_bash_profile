source ~/.dotfiles/shellrc

[[ $PS1 && -f /usr/share/bash-completion/bash_completion ]] && \
  source /usr/share/bash-completion/bash_completion

bind 'set show-all-if-ambiguous on'
bind 'set completion-ignore-case off'

bind '"\e[A":history-search-backward'
bind '"\e[B":history-search-forward'

export HISTCONTROL=ignoreboth:erasedups

__git_complete g __git_main
__git_complete cg __git_main

function _workspace() {
  COMPREPLY=()
  if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    local locals="$(git for-each-ref --sort=-committerdate --format='%(refname:lstrip=2)' refs/heads/)"
    local current="$(git branch --show-current)"
    local workspaces="$(echo -e "$locals" | grep -v HEAD | grep -v "$current")"
    COMPREPLY=($(compgen -W "$workspaces" -- "${COMP_WORDS[1]}"))
  fi
}

complete -o nosort -F _workspace workspace
complete -o nosort -F _workspace ws

if [ -e ~/.bashrc ]; then
  source ~/.bashrc
fi

function br {
  local cmd cmd_file code
  cmd_file=$(mktemp)
  if broot --outcmd "$cmd_file" "$@"; then
    cmd=$(<"$cmd_file")
    command rm -f "$cmd_file"
    eval "$cmd"
  else
    code=$?
    command rm -f "$cmd_file"
    return "$code"
  fi
}

eval "$(~/.local/bin/starship init bash)"
